#08 Multi-dimensional Modelling
##三、案例二：库存管理
###1.库存管理维度模型
用于大型杂货连锁店营销事务的维度模型
####值链
* 由企业的关键业务组成
* 值链确定了企业主体活动的自然逻辑流程
* 每一步都产生大量周期性的事务记录
* 决策支持系统的首要目标是监控关键处理过程的性能结果
	* 分析的依据是来自于每一步业务处理过程的事实表
	* 从每一步业务处理过程的业务数据库中可以衍生出一个或多个事实表
###2.事实表粒度模型
三种模型互补
####库存周期快照
* 目标  
	* 确保合适的商场在合适的时间中存在合适的商品
	* 最大限度地减少脱销现象，并减少存货维护的总体开销
* 零售商需要具备通过产品和商场分析出每天库存水平的能力
#####四步维度建模
* 促销并不是影响库存的主要因素，因此先将促销排除在维度范围之外
* 日期维度作为公共维度，形式与营销中保持一致
* 产品与商场维度也可以保持一致  
*可能需要根据实际的分析需求进一步引入其它属性*
	* 产品维度：最小重购数量
	* 商场维度：冷冻、冷藏面积

*按照维度建模的情况，这些因素在维度建模前就会全部考虑到；如果遗漏，模型演化的过程中可以得到补救*
#####库存周期快照的事实表与销售事务事实表的区别
* 销售事实表是**稀疏**的，库存事实表是**稠密**的
	* 销售事实表中记录每天实际发生的商品销售情况  
	面对所有可能组合，实际的数据量并不大
	* 库存事实表需要记录每天、每种商品在每个商场的库存情况，无论是否发生变化
* 解决办法  
随时间推移，降低周期快照的频度  
既降低了数据量，又没有影响效果
	* 最近60天内以天为粒度单位
	* 最近3年内以周为粒度单位
####半加型事实
* 只在部分维度上具有可加性
* 库存量可以跨产品或商场进行汇总（具有可加性），但跨日期不可加
* 用于记录静态水平的度量值在跨日期维度以及可能的其它维度范围内都是不可加的  
	* 对于不可加的度量值，可用的常用聚集方法如平均、统计
	* 不能简单地利用SQL中的AVG函数来完成这样的平均统计计算工作  
	功能与需求不符
####如果扩充事实表，则可以提供更多的分析操作
* 周转次数
* 日供给次数
* 库存毛利润（GMROI）  
由于此项完全不可加，因此不放置在事实表中
###3.库存事务
####库存周期快照无法提供的分析操作
* 发生过多少次产品入柜后又在同一天不同时间取出的情形
* 从某厂家那里接收过多少次分开装运的货，以及何时收到
* 哪些产品是由于出现多次检验不合格而导致向厂家退货的

频度测算和具体事务类型的计算需要库存事务模型的支持
####常见的库存事务模型
* 产品接收
* 产品送检
* 对检验合格的产品进行分发
* 将检验不合格的产品退给厂商
* ……

这些事务直接影响库存，或**虽不影响库存，但影响分析应用的正确性**
####库存事务记录事务事实
日期、产品、仓库、厂家、事务类型、数量（影响库存总量的值）
#####库存事务类型的维度
* 用于界定某条特定元组是事务中的哪一个
* 为了方便起见，可能还会将类型分组（库存增减、不变等）
####事实表的粒度
每个库存事务对应着事实表中的一行

	这样库存的粒度远比周期快照要低，保留了最低细节的数据
###4.库存累积快照
####模型思想
* 既不做抽样，也不将每个事务以一条元组进行记录
* 在事实表中为每种特定商品的入库装运给出相应的一行记录
* 对产品装载处理信息的跟踪放在单条记录中
> ######例：
> 假定数据进入数据仓库的同时，伴随着一系列良好定义的活动或重要事件，如接受、检验、入柜、销售批准等等
> 
> * 在事实表中添加多个活动不同的日期维度，将各种活动所牵涉到的度量值全部添加在事实表中
> * 一旦发生需要记录的事件，就在当前事实表中插入一条新的记录
> * 未来发生的环节并不知道发生的时间，甚至可能不知道是否发生  
> *此时需要一条特殊的日期记录，表示“尚未发生”*
> 	* 未来的环节发生后，就对当前的记录进行相应的修改  
> 直到所有环节全部完成为止，所有日期维度的外键全部指向实际日期
> 	* 若各个环节无法完全完成，可以将剩余日期指向另一个特殊元组  
> *“没有发生，将来也不可能发生”*
> 
####特点
* 库存累积快照事实表中存在多个取值为日期的外关键字
* 需要对事实表中的每一行进行多次的访问和修改操作  
这会违反数据仓库的一般性原则
* 很少用于长期运行而需要不断进行补充的库存处理  
时间跨度大的更为合适
###5.主题的集成
####集成的目的
* 跨主题范围地数据查看分析
* 使得来自不同主题的度量值可以被组合到单个分析任务中去
####集成的方式
* 共享**公共维度**的设计，不同的事实表引用相同的维度
* 数据仓库的总线结构  
将公共维度进行串联，不同的主题可以异地、同时开发，并行进行数据仓库的建设，总线结构也就可以独立于技术手段和数据库平台
* 私有维度是可能存在的  
但本质上每个维度都可能存在于总线上
#####数据仓库总线矩阵
* 各行为不同的主题，各列为不同的公共维度
	* 每一个主题都要能清晰定义
	* 每个公共维度至少要被标记两次
* 每使用一个维度，就在对应交叉点上进行标记
* 总线矩阵可以指导数据仓库的迭代开发
	* 听取数据分析人员的分析需求
	* 挑选公共维度组成最接近的主题在同一批次开发  
	因为这些主题最有可能被放在一起进行分析
	* 进行数据仓库开发时，完成总线矩阵后，多维建模之前要先完成公共维度的开发  
	但是需要首先考虑首轮迭代开发需要的维度
	* 讨论维成员时需要兼顾所有主题
#####一致性维度
一致性维度是进一步开发总线结构数据仓库的基础

	要么是同一的，要么是具有最佳力度与细节性的维度在严格数学意义上的子集
* 一致的维度可能是相同的维度表  
也可能是不同的表，但它们应该具有**相同数目的行、相同的关键字值、相同的属性标签、相同的属性定义和相同的属性值**
* 大多数一致的维度是在可能的最佳（最细）粒度层次上定义的
	> ######例：
	> * 顾客维：单个顾客
	> * 产品维：用以对产品进行跟踪的最低层次
	> * 日期维：天
* 两个处于相同细节层次上的维度表，如果它们均是另一个维表的子集，则它们也是一致的  
	> ######例：全体商品与各小类商品的一致性
	> 示意Venn图见ppt36页
* 不同业务处理的事实粒度不同  
如产品维度和商标维度之间的关系，可以通过将产品维度通过一致性处理转化为商标维度
#####一致性事实
* 同样的事实在不同数据备份中存储的一致性
	* 取值单位的一致性
	* 值的一致性
	* 自然关键字的一致性
* 一般来说事实表数据不在多个数据备份间进行明确的拷贝
* 如果存在多个备份，支撑这些事实的定义与方程必须都是相同的  
如果无法使事实完全保持一致，那么应该给不同的解释提供不同的名称