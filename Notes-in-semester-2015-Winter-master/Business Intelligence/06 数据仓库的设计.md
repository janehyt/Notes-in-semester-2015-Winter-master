#06 Design of Data Warehouse
##一、数据仓库设计的由来
数据库设计与数据仓库设计在原理上是一致的

* 很多数据库设计中的设计思想与方法可以在数据仓库中得到应用
* 两者也存在差别
	* 面向OLTP的数据库设计有**明确的应用需求**，遵循系统生命周期的阶段划分  
	非常详尽，尽管需要分析
	* 而数据仓库不存在明确的需求  
	数据仓库标准的好坏十分主观，对每个人都不同，且易变  
	数据仓库在填充数据前是无法得知需求的  

*因此无法使用传统的需求驱动的方法进行开发*
###1.建造数据仓库的主要部分
* ETL设计
* 数据仓库本身的设计
###2.数据仓库与操作型数据库的区别
* 面向的处理类型不同  
应用/分析
* 面向的需求不同  
确定的应用需求/不确定的分析需求
* 系统设计目标不同  
事务处理性能/全局一致的数据环境
* 数据来源或系统输入不同  
事务相关数据/多种多样
* 系统设计的方法和步骤不同  
SDLC（系统生命周期）/**CLDS**  
	> ######*SDLC与CLDS的过程见ppt第5页*
	> * 在数据仓库建立之前，需求无法确定，或十分抽象
	> * 数据仓库面向所有应用，即使有相对明确的分析需求也是无法满足真正需求的
	> * 数据仓库设计过程中，唯一的初始依赖只能是**数据**
	> * 单就需求来看，SDLC与CLDS恰好颠倒  
	> *这也是CLDS的名称由来*
##二、数据仓库设计的原则
面向主题、集成、非易失、时变的特点决定数据仓库的系统设计不能采用同OLTP开发相同的设计方法
###1.面向主题原则
####建立数据仓库的目的
建立数据仓库就是为了做分析，而分析是以主题为中心的，它们互相有关联，因此必须从用户决策的主观需求（主题）开始
####数据仓库中数据的组织方法
* 首先要有分析的主题  
以主题为起始点，进行相关数据的设计，最终建立起一个面向主题的分析型环境
* 数据库的设计以客观操作需求为设计依据
###2.数据驱动原则
####数据的来源
* 数据仓库本身并没有产生和存放数据的能力，在显存数据库系统上进行开发
* 数据仓库中的数据必须从已有数据源中抽取而来，或对已存在的数据进行加工处理而获得
####数据驱动方法
从已经存在于操作型数据环境中的数据出发进行数据仓库设计的方法

* 从已有的数据库系统出发
* 按照分析领域对数据及数据间的联系重新考察
* 利用数据模型有效识别原有数据库中的数据和数据仓库中主题的数据的共同性

*信息化做得好的企业，应当先构建抽象的数据模型，为数据库与数据仓库的建立提供参考*  
操作型数据环境与分析型数据环境结构类似的话，ETL的处理过程将十分容易
###3.原型法设计原则
####不断变化的分析需求
* 数据仓库的开发过程非常不明确，有非常多的不确定因素
* 因此要从构建系统的基本框架着手，不断丰富与完善整个系统
####逐步求精的设计过程
* 数据仓库的用户需求在设计过程中不断细化、明确
* 因此在数据仓库开发过程中，要**以企业为主导**，建立开发和维护的团队，开发者和决策人员**始终**共同参与，密切合作
####启发方式
* 一个迭代的开发依赖上一个迭代的结果
* 首先载入一部分数据供DSS分析员使用、查看
* 然后根据最终用户的反馈，修改数据或添加其它数据  
这一过程贯穿于数据仓库的整个开发生命周期中

***需求预测****仍然十分重要，实际情况通常介于启发与预测之间*
##三、数据仓库的设计过程
###1.操作性数据作为数据输入
####ETL
不是简单的抽取

* 解决同名异义、异义同名、度量衡等问题  
* 处理档案数据
* 数据仓库刷新的策略
* 考虑操作型数据存取的效率
* 数据量的管理
	* 数据集成
	* 多粒度
	* 数据转储
###2.过程/数据模型与设计环境
####过程模型
仅仅适用于操作型环境

* 功能分解
* DFD
* 上下文图
* 结构图表
* 状态转换图
* HIPO图
* 伪代码

分析型应用中并不存在“过程”，因此并不适用
####数据模型
操作型环境与分析型环境都适用  
*但操作型环境通常不使用，因为成本比较大*
#####数据模型的性质
**稳定性分析**

* 根据各个数据属性的变化特性将属性分组  
访问频率、更改频率……
* 根据稳定程度讨论逻辑优化、物理优化和ETL设计等  
分配存储空间和硬件资源时可以有所侧重，ETL的刷新频率也可以灵活调整
#####数据模型与迭代开发
######迭代开发的重要性
* 业界的成功记录强烈建议如此操作
* 用户在第一次迭代开发完成之前不能清晰地提出需求
* 只有实际结果切实且明确时，管理部门才会做出充分的承诺
* 必须能很快地见到结果
######数据模型的重要性
* 开发结束时，所有遍次的开发结果融合在一起
	> 数据模型可以粗糙，但需要有：
	> 
	> * 明确每次开发的边界
	> * 明确边界之间的衔接
* 如果不使用数据模型，
	* 可能产生数据不一致
	* 产生重复工作
###3.数据仓库设计的三级数据模型
* 概念模型、逻辑模型、物理模型
* 高级、中级、低级模型
##四、数据仓库的设计步骤
###1.系统规划
####明确主题
主题不太可能一步到位，粗糙一点也无所谓
####技术准备
* 技术评估
	* 数据存取能力
	* 模型重组能力
	* 数据装载能力
* 技术环境准备  
在评估基础上提出数据仓库的软硬件平台要求
###2.概念模型设计
####数据仓库的设计/生成和运维
做完概念模型设计后，对每一个选定的当前实施的主题进行逻辑模型和物理模型的设计，然后进行数据仓库生成
####概念模型设计
* 确定系统边界
* 确定主要的主题和内容
* OLAP等分析应用的设计
###3.逻辑模型设计
* 将E-R图转换为关系数据的二维表
* 定义数据源和数据抽取规则  
这是与数据库设计的不同

######*需要考虑以下问题*
* 适当的粒度划分  
	* 一般划分为详细数据、轻度总结、高度总结三种粒度
	* 粒度的划分直接对数据仓库的性能的用途产生影响
* 合理的数据分割策略
	* 表太大对创建索引和顺序扫描的效率有影响
	* 类似于数据库中的数据分片技术，目的是提高数据仓库的性能
	* 通常以时间作为分割依据  
	时间维度通常在多维模型中必不可少，也往往是最均匀的分割标准
* 定义合适的数据来源
###4.物理模型设计
在逻辑模型设计的基础上确定数据存储结构、索引策略、存储分配和数据存放位置等与物理有关的内容  
与数据库设计中大致相似
####常用技术
* 合并表  
表的连接操作消耗很多时间，将表合并后存放，可以节约连接的时间  
以空间换时间的策略
* 数据序列  
将连续使用的数据连续存储，原先表示逻辑的部分可以继续存在  
*这个技术在操作型环境中不能使用，因为会产生冗余，破坏数据库的一致性；而数据仓库主要进行的的查操作并不会带来一致性的影响*
* 引入冗余  
此处特指将一个属性从一张表扩散到其它表的过程  
这个过程中，数据仓库同样没有对数据一致性的担忧，冗余就可以节约访问的连接次数
* 表的物理分割  
类似逻辑设计阶段的数据分割，用拆分的表来表达原有逻辑意义上的一张表  
*区别在于逻辑设计阶段表的拆分分割记录，而物理设计阶段表的拆分分割不同具有性质的字段* 
* 生成导出数据  
如果某张表的统计数据被频繁访问，这部分聚集数据就可以另行记录，这张表用户透明
* 建立广义索引  
记录与“最”有关的统计结果  
这部分数据非常小，又可以在数据刷新阶段直接建立，进行此类查询时就可以将统计操作转换为简单查找  
*此方法在操作型数据环境中有若干变种实现*
###5.数据仓库生成
* 建立数据模式
* 编制数据抽取程序
* 数据加载
###6.使用和维护
* 建立分析、决策型的应用系统
* 依照原型法的思想，在使用过程中不断加深理解，改进主题
* 通过数据刷新维护数据仓库中数据的一致性