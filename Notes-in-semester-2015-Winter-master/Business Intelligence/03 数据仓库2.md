#03 数据仓库2
##三、数据仓库的基本结构
本章讨论数据仓库的关键技术
###1.数据的ETL（抽取、转换、装载）
####数据源
#####多数据源  
数据仓库的数据来源于多个数据源

* 不同格式的数据  
* 不同数据操作平台
* 不同物理位置
#####数据源可以是递归的
* 可以是另一个数据仓库（数据集市）
* 基于本数据仓库的分析型应用
#####数据源的抽取  
数据抽取软件
#####常见数据源
* 关系数据库系统  
Oracle, Sybase, SQL Server, DB2等
* 面向对象数据库系统  
Objectstore等
* 桌面数据库系统  
Foxbase, Foxpro等
* 文件系统中的数据文件
* 其它数据源，如Word, Excel等
####ETL过程
> **异构数据源——E——解析、校正、标准化、增补——匹配——合并——L——数据仓库**
> 
> * 解析以发现可能的关联
> * 数据库本身并不能保证数据的正确性，数据的组合也可能会发生原本隐藏的问题，因此必须做校正处理，修正错误的数据
> 	* 从原有的操作型应用中选择合理的增补数据
> 	* 以各种策略去猜  
> 		猜得越准确，代价越大
> * 使得数据在编码标准下一致
* ETL是一个约定俗称的叫法  
*但ETL未必按照这个顺序进行*  
转换与装载服务器分离时，两者的操作互斥；实际操作中可能会将两部分合并，转变成***ELT***的方式
####数据的抽取与刷新
#####数据抽取  
将数据源中的数据通过网络进行抽取，加工转换后形成仓库中的数据  
首次数据仓库的建立

* 数据抽取的重要性
	* 数据的抽取是数据进入仓库的入口
	* 屏蔽了数据结构和物理位置的复杂性
* 数据抽取的实现方法
不同的数据源可能需要不同的抽取方法
* 转换和集成的复杂性
	* 要实现变化  
	包括数据库系统、操作系统、硬件乃至基于硬件的数据结构的变化
	* 避免从在线窗口进行数据抽取  
		* 效率考量  
		* 在线窗口是不可靠的，可能令错误的数据进入数据仓库
	* 来自操作型环境中的输入关键字需要被重建和转换  
	某些关键字被局限在某个DB中
	* 非关键字数据需要重新格式化
	* 检查正确性
	* 数据源的合并
	* 关键字的解析
	* 必须定义一个明确的顺序  
	锁的机制只局限在一个数据库中，在数据仓库中不适用
	* 效率
	* 编码的转换
	* 理解逻辑与数据间的关系
	* ……
#####数据刷新
* 修正过时的数据，保存不变的数据
* 过程与抽取类似，但数据量更小
* 复杂性比数据抽取更高
* 数据仓库系统必须感知到OLTP数据库中数据的变化情况，并及时反映数据的变化情况
* 一般的刷新方法  
	四种刷新方式可以同时使用，以满足不同需要  
	先考虑日志文件，不行再用DELTA文件或时间戳，最后以映像文件保底
	* 时间戳			
		* 适用情况  
		数据库中的记录有时间属性，根据修改时间标志来实现数据仓库中数据的动态刷新
		* 缺点  
			大多数数据库系统中的数据不含时间戳
	* DELTA文件  
	向数据库进行操作时记录DELTA文件，用以做数据库调试和移植，以及一些特殊的操作（如回滚）
		* 适用情况  
		基于OLTP的操作性应用程序形成了DELTA文件记录该应用所作的数据修改操作
		* 优点  
		避免对整个数据库的对比扫描，具有较高的刷新效率
		* 缺点  
		现在应用不再记录DELTA文件，类似的机制集成到了数据库中
	* 映像文件
		* 实现方法  
		上一次刷新后对数据库做一次快照  
		本次刷新前再做一次快照  
		比较两个快照的不同从而确定刷新操作
		* 优点  
		对数据库和应用无特别要求，普适性好  
		*对于一些遗留系统可能比较有效*  
		保底的方法
		* 缺点  
		占用大量系统资源  
		可能较大地影响原有数据库系统的性能
	* 日志文件  
	原理与DELTA文件相同，区别在于谁记录了修改
		* 实现方法  
		根据OLTP的数据库日志信息来实现数据仓库的数据刷新
		* 优点  
		日志是OLTP数据库的固有机制  
		不会影响原有数据库的性能  
		具有比DELTA文件和映像文件更高的刷新效率
		* 缺点  
		无法应用与无日志文件机制的遗留数据库系统

数据抽取与刷新本质上的操作是相同的
#####数据周期  
从操作型数据环境数据变化起，到此变化反映到数据仓库中消耗的时间  
**通常不会低于24小时**，原因：

* 操作型数据环境与数据仓库结合得越紧密，所需技术就越昂贵、越复杂
* 数据稳定期的要求  
*数据在进入数据仓库前的调整十分简单，一旦进入数据仓库再做改动，就要同时调整操作性环境和数据仓库中的内容*
* 战略系统不太在乎最近一段时间的少量数据

数据周期对不同的数据单元也有不同
####ETL工具  
分为两类

* 产生源代码的软件
* 产生参数化的运行时模块的软件
	
什么适合就用什么，没有太大限制
###2.存储和管理
数据仓库的组织管理方式决定了它有别于传统数据库的特性，也决定了其对外数据表现形式

* 数据量很大
* 并行处理
* 针对决策支持查询的优化
* 支持多维分析的查询模式
####数据仓库中的数据
* 各个部门当前及历史上的细节性业务数据
* 为了进行分析决策操作而生成的分析性数据
####数据仓库中数据的管理
* 统一、集成、单一的庞大数据集合
* 需要借助成熟的数据库技术对其进行存储管理
####数据仓库的数据组织形式
* 简单堆积文件
* 轮转综合文件  
按时间统计的数据非常常见，达到一定规模后写入更大时间粒度的数据，清空小规模的分析性数据  

以上两种方法主要应用于经常变化的数据

* 简化直接文件  
每隔一段时间对数据库进行一次快照，对**全体数据**进行操作
* 连续文件
####数据仓库中的快照
#####快照的内容
* 关键字 
通常用复合关键字
* 时间单元  
用以区分快照描述事情发生的时刻  
全局的时间记录标准要保持一致  
时间单元可以被隐式、间接记录
* 主要数据
* 可选的二级数据  
附带信息，*可能有利于解释当前的主要数据*  
大多数情况下不会关注
#####快照的生成
由一些**离散活动**的发生而触发，或由规律性的**时间推移**而触发
####数据仓库管理系统
* 关系型数据库适当改进即可作为数据仓库管理系统
* 安全、归档、备份、维护、恢复等工作直接由DBMS的功能来实现
###3.数据目标
####原子层和集成数据
#####原子层
* 数据量最大，也是最重要的数据存储
* 逻辑上是其它所有分析应用数据的来源

特点：

* 保持历史继承性
* 拥有数据仓库最低细节（粒度）的数据
* 原子层的构建是迭代的  
数据的收集本身是迭代的  
分析人员的主观意愿一直在变化
* 数据结构面向企业  
整个企业所有分析人员的集合，而不是某个部门，某个个人
* 原子层本身可以是集成的  
搜集自不同的数据源
* 原子层是静态的
#####集成数据
######粒度  
数据仓库中数据综合程度的度量

* 影响数据仓库中数据量的多少
* 影响数据仓库能够回答询问的种类
######样本数据库  
从数据仓库中取得的真实档案数据或轻度综合数据的一个子集，即**从原子层抽样**
* 仓库中的一部分数据子集
* 周期性刷新  
原子层在不断变化，需要让新数据有机会成为样本中的数据成员
* 不能用于一般的分析目的，只能用于分析统计  
比如库存量的统计就非常适合做这种采样
######多重粒度  
低粒度，高细节与高粒度，低细节  
细节性查询只有低粒度高细节可以完成，宏观查询两者都可以完成，但此时明显是高粒度、低细节的数据更快、更高效  
虽然细节性查询所占比例非常小，但不能否认这是有意义的查询  
所以将两种粒度的数据同时存储，分别用于响应不同的查询

* 大粒度数据（集成数据）
	* 快速存储设备
	* 提高性能
* 小粒度数据
	* 低速存储设备
	* 满足细节查询
######多维度，多层次
数据仓库是**多维度**，**多层次**的

* 维度是观察数据对象的角度
* 层次是数据对象的综合程度
		
		
#####数据集市  
当前数据仓库面向某一问题域的子集
#####操作数据存储（ODS）  
弥补数据仓库滞后性的数据结构，有时被认为是数据仓库的一部分  
为了支持战术决策支持，存放更新的操作数据
######特点
* 面向特定分析应用  
不同于数据仓库，操作数据存储不需要面向所有应用，因为不是所有决策都是战术性的
* 完整性
* 当前有效
* 可变
* 详尽
	
> ######DB-ODS-DW的模型见ppt11页
> * 整个数据仓库的内容过多
> * 数据库无时无刻不在运作
> * 战术性决策可能有很多个，ODS也就可能有很多个
#####缓冲区
* 数据流的中间站
* 无特定过程
###4.数据的访问和表现
多通过第三方的工具软件完成
###5.元数据
关于数据的数据，描述了数据的结构、内容、编码、索引等内容  
**通过元数据可以将数据仓库和复杂的数据源系统的变化隔离，是数据仓库开发和维护的一个关键因素，也是保证数据抽取质量的依据**

元数据记录以下内容：

* 数据仓库程序员所知道的数据结构
* DSS分析员所知道的数据结构
* 数据仓库的源数据
* 数据进入数据仓库时发生的转换
* 数据模型
* 数据模型和数据仓库的关系
* 抽取数据的历史记录

####关于数据源的元数据
现有业务系统的数据源的描述信息  
对不同平台上的数据源的物理结构和含义的描述

* 数据源中所有物理数据结构
* 数据项的业务定义
* 数据进入数据仓库时发生的转换
* 数据项更新的频率  
频率来自对数据库的监视，或是数据仓库建立时的明确定义
* 数据项的有效值  
以及验证有效值的方法，用于ETL时的查错  
一些复杂的计算逻辑
* 其它系统中具有相同业务含义的数据项清单
####关于数据模型的元数据
*简单地说就是关系型数据库的数据字典*
####关于数据仓库映射的元数据
数据进入数据仓库的转换过程  
往往用一定的表达式或算法表示

* 数据源系统
* 数据处理过程  
还要包含对已经处理的元素的记录
* 数据的刷新
####关于数据仓库使用的元数据
数据仓库中信息使用情况的描述

* 有什么数据  
从哪里来的，如何按主题查看数据仓库的内容
* 提供已有的可重复利用的查询语言信息
####元数据的管理
* 一般存放于数据仓库中  
*可以任意存放*
* 受元数据管理系统的管理